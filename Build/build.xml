<?xml version="1.0"?>
<project name="project" default="run">
  <target name="run" description="">
  <echo message="Loading properties" />
    <property file="C:/Users/Admin/AppData/Local/Jenkins/.jenkins/workspace/IIB-TEST/Build/build.properties"/>
    <!--<property name="iib.createbar" value="C:/Program Files/IBM/ACE/12.0.5.0/tools" />
	<property name="iib.home" value="C:/Program Files/IBM/ACE/12.0.5.0" />
    <property name="bars.basedir" value="C:/Users/Admin/Archive" />
    <property name="bar.location" value="${bars.basedir}/BAR_APP_EMPLOYEE_DETAILS.bar" />
	<property name="application.name" value="APP_TEST" />-->
    <property name="workspace.dir" value="C:/Users/Admin/AppData/Local/Jenkins/.jenkins/workspace/IIB-TEST" />
	<property name="mqsi.applybaroverride" value="com.ibm.broker.config.util.ApplyBarOverride" />
	<property name="mqsi.applybaroverride.parameters" value="-b ${workspace.dir}/Bars/BAR_APP_TEST.bar -p ${workspace.dir}/Properties/${environment}/perf.properties -r" />
    <antcall target="build" />
	<antcall target="override" />
	<antcall target="deploy" />
  </target>
  
  <target name="build">
     <echo message="Creating Bar file @ mqsicreatebar -data ${workspace.dir} -b ${workspace.dir}/Bars/${bar.name} -a ${application.name} -deployAsSource" />
     <exec executable="${iib.createbar}/mqsicreatebar">
       	<arg value="-data" />
		<arg value="${workspace.dir}" />
		<arg value="-b" />
		<arg value="${workspace.dir}/Bars/${bar.name}" />
		<arg value="-a" />
        <arg value="${application.name}" /> 
		<arg value="-deployAsSource" />
     </exec>
	 <echo message="Bar file created sucessfully @ ${workspace.dir}/Bars/${bar.name}" />
  </target>
  
  <target name="override">
	<echo message="OVERRIDE target starting ..." />
	<echo message="Command line: java -cp ... ${mqsi.applybaroverride}  ${mqsi.applybaroverride.parameters}" />
	<java classname="${mqsi.applybaroverride}" failonerror="true" fork="true">
		<arg line="${mqsi.applybaroverride.parameters} -runtime" />
		<classpath>
   			<fileset dir="${iib.home}/server/classes">
    				<include name="*.jar"/>
   			</fileset>
			<fileset dir="${iib.home}/common/classes">
				<include name="*.jar"/>
			</fileset>
  		</classpath>
 	</java>
  </target>
  
  <target name="deploy">
	<!--<attribute name="inode" default="${iib.broker}" />
	<attribute name="hostname" default="localhost" />
	<attribute name="port" default="4417" />
	<attribute name="execgroup" default="${iib.server}"/>
	<attribute name="barfile" default="${workspace.dir}/Bars/${bar.name}" />
	<attribute name="timeoutsecs" default="180" />-->
	<sequential>
	<exec executable="cmd.exe" failonerror="true">
	<!--<arg line="${workspace.dir}/Build/deploycmd.bat '${iib.home}/server/bin' @{inode} @{hostname} @{port} @{execgroup} @{barfile} @{timeoutsecs}" />-->
		<arg value="${workspace.dir}/Build/deploycmd.bat '${iib.home}/server/bin'" />
		<arg value="${iib.broker}" />
		<arg value="localhost" />
		<arg value="4417" />
		<arg value="${iib.server}" />
		<arg value="${workspace.dir}/Bars/${bar.name}" />
		<arg value="180" />	
	</exec>
	</sequential>
  </target>
  <!--<target name="deploy"> 
	<echo message="Deploying barfile in ${environment}" />
	<exec executable="${workspace.dir}/Build/deploycmd.bat">
		<arg value="${iib.deploy}" />
		<arg value="${iib.broker}" />
		<arg value="localhost" />
		<arg value="4417" />
		<arg value="${iib.server}" />
		<arg value="${workspace.dir}/Bars/${bar.name}" />
		<arg value="180" />			
	</exec>
  </target>-->
  
</project>
